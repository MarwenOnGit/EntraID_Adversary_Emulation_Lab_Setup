# Ansible – Red Team Infrastructure Configuration

Configures EC2 instances via SSH. Playbooks install git, Go, and system tools.

## Files

- **`ansible.cfg`** — SSH config, private key path (`../terraform/keys/id_rsa`), inventory, logging
- **`inventory.ini`** — Auto-generated from Terraform (do not edit manually)
- **`playbooks/install-deps.yml`** — Install git and Go (downloads Go tarball, handles apt/yum)
- **`playbooks/base-setup.yml`** — System package installation (legacy)
- **`playbooks/deploy-evilginx.yml`** — Evilginx2 build (legacy)

## Quick Start

```bash
# 1. From terraform/ directory, generate inventory
cd ../terraform
./generate_ansible_inventory.sh
cd ../ansible

# 2. Install Ansible (if needed; assumes pipx)
pipx install ansible

# 3. Test SSH connectivity
ansible -i inventory.ini redteam -m ping

# 4. Run playbook to install git and Go
ansible-playbook -i inventory.ini playbooks/install-deps.yml
```

## Playbooks

**install-deps.yml** — Installs git and Go
- Handles Debian (apt) and RHEL (yum) systems
- Downloads Go from official tarball (default: 1.21.2, customizable)
- Adds `/usr/local/go/bin` to PATH via `/etc/profile.d/go.sh`

**base-setup.yml** — Legacy; installs common tools (curl, wget, nmap, python3)

**deploy-evilginx.yml** — Legacy; builds Evilginx2 from source

## Inventory Format

Generated by `terraform/generate_ansible_inventory.sh`:

```ini
[redteam]
redteam-01 ansible_host=<IP> ansible_user=ubuntu ansible_ssh_private_key_file=../terraform/keys/id_rsa

[redteam:vars]
ansible_python_interpreter=/usr/bin/python3
```

## Ansible Config Details

- `inventory = ./inventory.ini` — Relative path
- `private_key_file = ../terraform/keys/id_rsa` — Relative to ansible/ dir
- `remote_user = ubuntu` — Default SSH user
- `host_key_checking = False` — Skip host key verification
- `become = True` / `become_user = root` — Use sudo for tasks

## Troubleshooting

| Issue | Fix |
|-------|-----|
| SSH permission denied | Verify keys/id_rsa exists and ansible.cfg points to it correctly |
| Cannot find python3 | Playbook runs raw module first to install python3 |
| Instance still initializing | Instance takes 30-60s after launch; wait before retrying |

## Typical Workflow

```bash
cd terraform && terraform apply -auto-approve && ./generate_ansible_inventory.sh
cd ../ansible
ansible -i inventory.ini redteam -m ping
ansible-playbook -i inventory.ini playbooks/install-deps.yml
```
